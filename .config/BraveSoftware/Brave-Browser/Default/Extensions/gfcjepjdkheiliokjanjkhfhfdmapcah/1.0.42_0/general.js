const __circlePointerId="pointerCircleId";function __createClickMark(e,t){const n=document.createElement("div");n.style.position="absolute",n.style.borderRadius="50%",n.style.width="3px",n.style.height="3px",n.style.left=e+"px",n.style.top=t+"px",n.style.backgroundColor="green",n.style.zIndex="9999",n.style.pointerEvents="none",document.body.appendChild(n)}function __injectLink(e,t){const n=document.createElement("a");return n.href=e,n.innerText=t,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.zIndex="9999",document.body.appendChild(n),n}function __randomBetween(e,t){return Math.floor(Math.random()*(t-e+1)+e)}window.__mouseX=__randomBetween(0,window.innerWidth),window.__mouseY=0;let timeoutId=0,intervalId=0;function __setTimeout(e,t){return new Promise((n=>{const a=timeoutId++;chrome.runtime.sendMessage({command:"setTimeout",id:a,timeout:t},(t=>{const s=t.timeoutId;chrome.runtime.onMessage.addListener((function t(r){"timeout"===r.command&&r.id===a&&(chrome.runtime.onMessage.removeListener(t),e(),n(s))}))}))}))}function __clearTimeout(e){chrome.runtime.sendMessage({command:"clearTimeout",id:e})}function __setInterval(e,t){return new Promise((n=>{const a=intervalId++;chrome.runtime.sendMessage({command:"setInterval",id:a,interval:t},(t=>{const s=t.intervalId;chrome.runtime.onMessage.addListener((function(t){"interval"===t.command&&t.id===a&&e()})),n(s)}))}))}function __clearInterval(e){chrome.runtime.sendMessage({command:"clearInterval",id:e})}async function __sleep(e){return new Promise((t=>{__setTimeout((function(){t()}),e)}))}function __waitUntil(e,t,n,a){return new Promise(((s,r)=>{let o=0;__setTimeout((function i(){o++,e(a).then((e=>{e?s(e):o>=n?s(null):__setTimeout(i,t)})).catch((e=>{r(e)}))}),t)}))}function nearLetterOnKeyboard(e){let t=e.charCodeAt(0)+__randomBetween(-1,1);return String.fromCharCode(t)}async function __smoothScroll(e,t=50,n=100){return new Promise((async a=>{let s=null;"object"==typeof e?(s=e,e=s.getBoundingClientRect().top+window.scrollY):void 0===e&&(e=window.pageYOffset+__randomBetween(0,window.innerHeight));let r=window.pageYOffset,o=e-r;const i=Math.ceil(Math.abs(o)/t);t=o/i;for(let e=0;e<i;e++){r+=t,window.scroll(0,Math.round(r));let e=new Event("scroll");window.dispatchEvent(e),await __sleep(n)}window.scroll(0,e);let c=new Event("scroll");window.dispatchEvent(c),s&&s.scrollIntoView({behavior:"smooth",block:"center"}),a()}))}const __fullScrollDown=async(e,t)=>{const n=__randomBetween(e,t);for(let e=0;e<n;e++){let e=document.body.scrollHeight;await __smoothScroll(e),await __sleep(__randomBetween(1e3,3e3))}},randomScrollAndMove=async(e,t)=>{const n=async()=>{const e=__randomBetween(0,window.innerWidth),t=__randomBetween(0,window.innerHeight);await __besierMouseMoveEvents([e,t])};await n();let a=__randomBetween(e,t);for(let e=0;e<a;e++){await __sleep(__randomBetween(300,1400));const e=__randomBetween(.1*document.body.scrollHeight,.6*document.body.scrollHeight);await __smoothScroll(e),await __sleep(__randomBetween(700,4e3)),Math.random()>.6&&await n()}};var __typeText=async function(e,t){await __mouseClick(e),await __sleep(__randomBetween(1e3,2e3)),e.focus();for(let e=0;e<t.length;e++){let n=t[e];if(Math.random()>.9){let e=nearLetterOnKeyboard(n);document.execCommand("insertText",!1,e),await __sleep(__randomBetween(100,500)),document.execCommand("delete",!1),await __sleep(__randomBetween(100,500))}document.execCommand("insertText",!1,n),await __sleep(__randomBetween(50,400))}},__simulateMouseEvent=function(e,t,n,a){window.__mouseX=n,window.__mouseY=a;let s=document.getElementById("pointerCircleId");s&&(s.style.left=n+window.pageXOffset+"px",s.style.top=a+window.pageYOffset+"px");try{e.dispatchEvent(new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,clientX:n,clientY:a,button:0}))}catch(e){}};function __isClickable(e){var t=e.getBoundingClientRect();return t.width>0&&t.height>0&&t.bottom>0&&t.right>0&&t.top<(window.innerHeight||document.documentElement.clientHeight)&&t.left<(window.innerWidth||document.documentElement.clientWidth)}function __getRe(e,t){try{return e.exec(t)[1]}catch(e){return null}}async function __besierMouseMoveEvents(e){let t=new __Vector2(window.__mouseX,window.__mouseY),n=null;if(!1===Array.isArray(e)){let t=e.getBoundingClientRect();e.style.border="1px dashed red",n=__getRandomBoxPoint(t,{paddingPercentage:35})}else n=new __Vector2(e[0],e[1]);const a=__vec_distance(t,n);let s=__path(t,n);const r=2*a/200;for(let e=0;e<s.length;e++)__simulateMouseEvent(document.body,"mousemove",s[e].x,s[e].y),await __sleep(r);return[n.x,n.y]}function __removeAllLinksTarget(){document.querySelectorAll("a").forEach((function(e){e.removeAttribute("target")}))}async function __mouseClick(e,t=!1){if(__removeAllLinksTarget(),!e)return;var n=e;if("string"==typeof e&&(n=document.querySelector(e)),!n)return;n.scrollIntoView({behavior:"instant",block:"center"}),n.style.border="1px dashed red",await __sleep(__randomBetween(1e3,2e3));let[a,s]=await __besierMouseMoveEvents(n);await __sleep(__randomBetween(500,1500)),__removeAllLinksTarget();let r=document.elementFromPoint(a,s);a<=0||s<=0||r!==n?n.click():(__simulateMouseEvent(n,"mousedown",a,s),__simulateMouseEvent(n,"mouseup",a,s),__simulateMouseEvent(n,"click",a,s),t&&(__simulateMouseEvent(n,"mousedown",a,s),__simulateMouseEvent(n,"mouseup",a,s),__simulateMouseEvent(n,"click",a,s),__simulateMouseEvent(n,"dblclick",a,s))),__createClickMark(a,s),await __sleep(__randomBetween(1e3,1500))}const __foundParentNodeBySelector=function(e,t){return e.matches(t)?e:e.parentElement?__foundParentNodeBySelector(e.parentElement,t):null},__serialize=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};function __post(e,t,n){return n||(n=!1),new Promise(((a,s)=>{let r=new XMLHttpRequest;r.open("POST",e,!0),r.withCredentials=n,r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onload=function(){200==r.status?a(r.responseText):s(r.statusText)},r.onerror=function(){s(r.statusText)};var o=__serialize(t);r.send(o)}))}async function __get(e,t,n){return n||(n=!1),new Promise(((a,s)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.withCredentials=n,r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onload=function(){200==r.status?a(r.responseText):s(r.statusText)},r.onerror=function(e){s(r.statusText)};var o=__serialize(t);r.send(o)}))}function __foundUpParentNode(e,t){for(var n=e.parentNode;null!=n;){if(n.nodeName.toLowerCase()==t)return n;n=n.parentNode}return null}function __randomDomainLink(){var e=document.querySelectorAll("a"),t=location.protocol+"//"+location.host;let n=[];return e.forEach((function(e){if(e){var a=e.getAttribute("href");a&&(a.startsWith("/")||a.startsWith(t))&&n.push(e)}})),n[Math.floor(Math.random()*n.length)]}async function setPart(e){await chrome.storage.sync.set({partName:e})}async function getPartName(){return(await chrome.storage.sync.get("partName")).partName}async function getPart(){try{const e=await chrome.storage.sync.get("partName"),t=await chrome.storage.sync.get("parts");return e.partName&&t.parts?t.parts[e.partName]:null}catch(e){return null}}async function getTaskId(){return(await chrome.storage.sync.get("taskId")).taskId}async function resetParts(){await chrome.storage.sync.set({parts:{},partName:null})}async function setPartIteration(e,t){let n=await chrome.storage.sync.get("partIterations");n=n.partIterations||{},n[e]=t,await chrome.storage.sync.set({partIterations:n})}async function partIteration(e){let t=await chrome.storage.sync.get("partIterations");return t=t.partIterations||{},t[e]||0}function __base64Encode(e){try{return btoa(e)}catch(e){return""}}function __base64Decode(e){try{return atob(e)}catch(e){return""}}function __decodeURIComponent(e){return decodeURIComponent(e)}function __encodeURIComponent(e){return encodeURIComponent(e)}async function __sendMessage(e,t){return new Promise(((n,a)=>{chrome.runtime.sendMessage({type:e,data:t},(function(e){n(e)}))}))}Element.prototype.remove=function(){try{this.parentElement.removeChild(this)}catch(e){}},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=this.length-1;e>=0;e--)if(this[e]&&this[e].parentElement)try{this[e].parentElement.removeChild(this[e])}catch(e){}};class StateMachineResolver{constructor(){this.variables={},this.logger=[],this.taskId=null,this.commands={set:this.setVariable.bind(this),get:this.getVariable.bind(this),for:this.forLoop.bind(this),if:this.ifStatement.bind(this),array:this.arrayManipulation.bind(this),dom:this.domManipulation.bind(this),break:this.breakStatement.bind(this),continue:this.continueStatement.bind(this),try:this.tryBlock.bind(this),object:this.objectManipulation.bind(this),await:this.awaitExpression.bind(this),math:this.mathOperation.bind(this),stringify:this.stringify.bind(this),parse:this.parse.bind(this),console:this.consoleLog.bind(this),regex:this.regexOperation.bind(this),string:this.stringOperation.bind(this),function:this.functionCall.bind(this),exit:this.exit.bind(this)},this.functions={__sendMessage:__sendMessage.bind(this),__typeText:__typeText.bind(this),__foundParentNodeBySelector:__foundParentNodeBySelector.bind(this),__mouseClick:__mouseClick.bind(this),__sleep:__sleep.bind(this),__randomBetween:__randomBetween.bind(this),__randomDomainLink:__randomDomainLink.bind(this),__base64Encode:__base64Encode.bind(this),__base64Decode:__base64Decode.bind(this),__decodeURIComponent:__decodeURIComponent.bind(this),__encodeURIComponent:__encodeURIComponent.bind(this),__fullScrollDown:__fullScrollDown.bind(this),htmlContent:this.htmlContent.bind(this),randomScrollAndMove:randomScrollAndMove.bind(this),postRequest:this.makePostRequest.bind(this),getRequest:this.makeGetRequest.bind(this),setPart:setPart.bind(this),resetParts:resetParts.bind(this),executionResult:this.executionResult.bind(this)},window.setTimeout=__setTimeout,window.setInterval=__setInterval,window.clearTimeout=__clearTimeout,window.clearInterval=__clearInterval;let e=document.getElementById("pointerCircleId");e||(e=document.createElement("div"),e.style.position="absolute",e.style.borderRadius="50%",e.style.width="9px",e.style.height="9px",e.style.left="0px",e.style.top="0px",e.style.backgroundColor="red",e.style.pointerEvents="none",e.style.zIndex="8888",e.id="pointerCircleId",window.setTimeout((()=>{document.body.appendChild(e)}),500)),document.addEventListener("scroll",(t=>{e.style.left=window.__mouseX+"px",e.style.top=window.__mouseY+window.scrollY+"px"}))}async htmlContent(){return document.documentElement.outerHTML}async log(e,t=!1){const n=new Date;await __sendMessage("log",[{message:e,error:t,taskId:this.taskId,timestamp:n.getTime()}])}async executionResult(e){__sendMessage("executionResult",{taskId:this.taskId,data:e})}async error(e){await this.log(e,!0)}async execute(e,t){this.taskId=t,await this.executeRaw(e,!0)}async exit(){throw"exit"}async executeRaw(e,t=!1){const n=await getPartName();let a=0;if(t){const e=await getPartName(),t=await partIteration(e);a=t,this.log(`Execute part: ${e} with iteration: ${t}`)}for(;a<e.length;a++){t&&await setPartIteration(n,a+1);const s=e[a],[r,o]=Object.entries(s)[0];try{await this.commands[r](o)}catch(e){if("break"===e.message||"continue"===e.message)throw e;this.error(e)}}}async getVariable(e){const[t]=e;return this.variables[t]}async setVariable(e){const[t,n]=e,a=await this.resolveValue(n);this.variables[t]=a}async functionCall(e){const[t,...n]=e;if("function"==typeof this.functions[t]){const e=await this.resolveValue(n);return await this.functions[t](...e)}}async makePostRequest(e,t,n=!1){return await __post(e,t,n)}async makeGetRequest(e,t,n=!1){return this.log("Make get request: ",e,t,n),await __get(e,t,n)}async forLoop(e){const[t,n,a,s]=e;for(let e=await this.resolveValue(t);e<await this.resolveValue(n);e+=await this.resolveValue(a)){this.setVariable(["loopCounter",e]);try{await this.executeRaw(s)}catch(e){if("break"===e.message)break;if("continue"===e.message)continue;throw e}}}async ifStatement(e){const[t,n,a]=e;let s=!0;for(const e of t)if(Array.isArray(e)){const[t,n,a]=await Promise.all(e.map(this.resolveValue.bind(this)));s=s&&this.evaluateCondition(t,n,a)}else if("||"===e){if(s)return void await this.executeRaw(n);s=!0}else if("&&"===e&&!s)return void(a&&await this.executeRaw(a));s?await this.executeRaw(n):a&&await this.executeRaw(a)}async arrayManipulation(e){const[t,...n]=e,a=await this.resolveValue([n[0]]),s=await this.resolveValue(n[1]),r=await this.resolveValue(n[2]);switch(t){case"push":a.push(s);break;case"pop":return a.pop();case"slice":return a.slice(s,r);case"indexOf":return a.indexOf(s);case"includes":return a.includes(s);case"join":return a.join(s);case"reverse":return a.reverse();case"length":return a.length;case"random":return a[Math.floor(Math.random()*a.length)];case"getByIndex":if(s>=0&&s<a.length)return a[s];throw new Error("Index out of bounds");case"setByIndex":if(!(s>=0&&s<a.length))throw new Error("Index out of bounds");a[s]=r}}async domManipulation(e){const[t,...n]=e,a=await this.resolveValue(n[0]),s=await this.resolveValue(n[1]),r=await this.resolveValue(n[2]);switch(t){case"get":{let e=a,t=s;return t=t||document,t.querySelector(e)}case"getAll":{let e=await this.resolveValue(s);return e=e||document,Array.from(e.querySelectorAll(a))}case"create":return document.createElement(a);case"append":a.appendChild(s);break;case"prepend":a.prepend(s);break;case"remove":a.remove();break;case"set":a[s]=r;break;case"getRaw":return a[s];case"call":{let e=n.slice(2),t=await Promise.all(e.map(this.resolveValue.bind(this)));return a[s](...t)}}}breakStatement(){throw new Error("break")}continueStatement(){throw new Error("continue")}async tryBlock(e){const[t,n,a]=e;try{await this.executeRaw(t)}catch(e){this.setVariable([n,e]),await this.executeRaw(a)}}async objectManipulation(e){const[t,n,a]=e;switch(t){case"set":const e=await this.resolveValue(n),t=await this.resolveValue(a);return Object.assign(e,t),e;case"get":return(await this.resolveValue(n))[await this.resolveValue(a)];case"delete":delete(await this.resolveValue(n))[await this.resolveValue(a)];break;case"keys":const s=await this.resolveValue(n);return Object.keys(s);case"values":const r=await this.resolveValue(n);return Object.values(r);case"merge":const o=await this.resolveValue(n);return(await Promise.all(a.map((e=>this.resolveValue(e))))).forEach((e=>{Object.assign(o,e)})),o;case"entries":const i=await this.resolveValue(n);return Object.entries(i)}}async awaitExpression(e){const[t]=e;return await this.resolveValue(t)}async mathOperation(e){const[t,...n]=e;let a=[];for(let e=0;e<n.length;e++){const t=await this.resolveValue(n[e]),s=Number(t);a.push(s)}switch(t){case"+":return a.reduce(((e,t)=>e+t),0);case"-":return a.reduce(((e,t)=>e-t));case"*":return a.reduce(((e,t)=>e*t),1);case"/":return a.reduce(((e,t)=>e/t));case"min":return Math.min(...a);case"max":return Math.max(...a);case"round":return Math.round(a[0]);case"floor":return Math.floor(a[0]);case"ceil":return Math.ceil(a[0]);case"random":return Math.random()}}async stringify(e){const[t]=e;return JSON.stringify(await this.resolveValue(t))}async parse(e){const[t]=e;return JSON.parse(await this.resolveValue(t))}async consoleLog(e){let t="";for(const n of e){t+=(await this.resolveValue(n)).toString()+" "}this.log(t)}async regexOperation(e){const[t,...n]=e,a=await this.resolveValue(n[0]),s=await this.resolveValue(n[1]),r=await this.resolveValue(n[2]),o=new RegExp(a,s);switch(t){case"test":return o.test(r);case"exec":return o.exec(r);case"match":return r.match(o);case"search":return r.search(o);case"replace":return r.replace(o,await this.resolveValue(n[3]));case"split":return r.split(o)}}async stringOperation(e){const[t,...n]=e,a=await this.resolveValue(n[0]),s=await this.resolveValue(n[1]),r=await this.resolveValue(n[2]);switch(t){case"length":return a.length;case"charAt":return a.charAt(s);case"concat":const e=n.slice(1),t=await Promise.all(e.map(this.resolveValue.bind(this)));return a.concat(...t);case"includes":return a.includes(s,r);case"indexOf":return a.indexOf(s,r);case"match":return a.match(s);case"replace":return a.replace(s,r);case"slice":return a.slice(s,r);case"split":return a.split(s,r);case"substring":return a.substring(s,r);case"toLowerCase":return a.toLowerCase();case"trim":return a.trim()}}evaluateCondition(e,t,n){switch(t){case"==":return e==n;case"!=":return e!=n;case">":return e>n;case">=":return e>=n;case"<":return e<n;case"<=":return e<=n;default:throw new Error(`Unknown operator: ${t}`)}}async resolveValue(e){if((t=e)instanceof Element||t instanceof HTMLDocument)return e;if(Array.isArray(e)){const t=await Promise.all(e.map(this.resolveValue.bind(this)));return 1===t.length&&Array.isArray(t[0])?t[0]:t}if("object"==typeof e&&null!==e){if(1===Object.keys(e).length){const[t,n]=Object.entries(e)[0];if("function"==typeof this.commands[t]){const e=await this.resolveValue(n);return await this.commands[t](e)}}const t={};for(const[n,a]of Object.entries(e))t[n]=await this.resolveValue(a);return t}var t;return e}}